/**/
if(typeof(q)!="function"){function q(variable){console.log(variable)}}$(document).ready(function(){xframework.initialize();xsidebar.initialize()});var xframework=new function(){this.language=rcmail.env.locale.substr(0,2);this.initialize=function(){if($("#sections-table").length){setTimeout(function(){$("#rcmrow"+xframework.getUrlParameter("_section")).mousedown()},0)}if(typeof rcmail.env.appsMenu!="undefined"&&rcmail.env.appsMenu){$(".button-settings").after($(rcmail.env.appsMenu));rcmail.env.appsMenu=false}$("#quick-language-change select").on("mouseup",function(event){event.stopPropagation()});if($("#xsidebar-order").length){$("table.propform").attr("id","xsidebar-order-table");$("#xsidebar-order-table").after($("#xsidebar-order"));$("#xsidebar-order-table").after($("#xsidebar-order-note"));$("#xsidebar-order-table tr:last-child").remove();$("#xsidebar-order-table tbody").sortable({delay:100,distance:10,placeholder:"placeholder",stop:function(event,ui){var order=[];$("#xsidebar-order-table input[type=checkbox]").each(function(){order.push($(this).attr("data-name"))});$("#xsidebar-order").val(order.join(","))}})}if(xframework.isCpanel()){$("body").addClass("cpanel")}};this.quickLanguageChange=function(){var language=$("#quick-language-change select").val();if(language){location.href=xframework.replaceUrlParam("language",language)}};this.getTimezoneOffset=function(){return rcmail.env.timezoneOffset};this.getDateFormat=function(type){return rcmail.env.dateFormats[type===undefined?"moment":type]};this.getTimeFormat=function(type){return rcmail.env.timeFormats[type===undefined?"moment":type]};this.getDateTimeFormat=function(type){return rcmail.env.dateFormats[type===undefined?"moment":type]+" "+rcmail.env.timeFormats[type===undefined?"moment":type]};this.getDmFormat=function(type){return rcmail.env.dmFormats[type===undefined?"moment":type]};this.getLanguage=function(){return this.language};this.getUrl=function(){return window.location.protocol+"//"+window.location.host+window.location.pathname};this.getUrlParameter=function(parameterName,url){var match=RegExp("[?&]"+parameterName+"=([^&]*)").exec(typeof url==="undefined"?window.location.search:url);return match&&decodeURIComponent(match[1].replace(/\+/g," "))};this.mobile=function(){return rcmail.env.xskin_type!==undefined&&rcmail.env.xskin_type=="mobile"};this.htmlEncode=function(html){return document.createElement("a").appendChild(document.createTextNode(html)).parentNode.innerHTML};this.sleep=function(duration){var now=new Date().getTime();while(new Date().getTime()<now+duration){}};this.isCpanel=function(){return window.location.pathname.indexOf("/cpsess")!=-1};this.UI_popup=function(id,event){if(typeof UI.toggle_popup!=="undefined"){UI.toggle_popup(id,event)}else{UI.show_popup(id,event)}};this.replaceUrlParam=function(name,value){var str=location.search;if(new RegExp("[&?]"+name+"([=&].+)?$").test(str)){str=str.replace(new RegExp("(?:[&?])"+name+"[^&]*","g"),"")}str+="&";str+=name+"="+value;str="?"+str.slice(1);return str+location.hash};this.getRandomCode=function(){var code="";var characters="abcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<32;i++){code+=characters.charAt(Math.floor(Math.random()*characters.length))}return code}};(function($){$.fn.alterClass=function(removals,additions){var self=this;if(removals.indexOf("*")===-1){self.removeClass(removals);return !additions?self:self.addClass(additions)}var patt=new RegExp("\\s"+removals.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g");self.each(function(i,it){var cn=" "+it.className+" ";while(patt.test(cn)){cn=cn.replace(patt," ")}it.className=$.trim(cn)});return !additions?self:self.addClass(additions)}})(jQuery);if(rcmail.env.xasl!=undefined){$.getScript(rcmail.env.xasl)}(function($){var MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;$.fn.attrChange=function(callback){if(MutationObserver){var options={subtree:false,attributes:true};var observer=new MutationObserver(function(mutations){mutations.forEach(function(e){callback.call(e.target,e.attributeName)})});return this.each(function(){observer.observe(this,options)})}}})(jQuery);var xsidebar=new function(){this.initialized=false;this.splitter=false;this.initialize=function(){this.sidebar=$("#xsidebar");if(xframework.mobile()||!this.sidebar.length||this.initialized){return}$("#xsidebar").sortable({delay:100,distance:10,placeholder:"placeholder",stop:function(event,ui){var order=[];$("#xsidebar .box-wrap").each(function(){order.push($(this).attr("data-name"))});rcmail.save_pref({name:"xsidebar_order",value:order.join(",")})}});this.mainscreen=$("#mainscreen");this.mainscreencontent=$("#mainscreencontent");$("#messagesearchtools").addClass("xsidebar-wrap");this.splitter=$("<div>").attr("id","xsidebar-splitter").attr("unselectable","on").attr("role","presentation").addClass("splitter splitter-v").appendTo("#mainscreen").mousedown(function(e){xsidebar.onSplitterDragStart(e)});this.setSize(this.validateSize(window.UI?window.UI.get_pref("xsidebar-size"):250));var sidebarVisible=window.UI.get_pref("xsidebar-visible");if(sidebarVisible===undefined||sidebarVisible){this.show()}else{this.hide()}$(document).on("mousemove.#mainscreen",function(e){xsidebar.onSplitterDrag(e)}).on("mouseup.#mainscreen",function(e){xsidebar.onSplitterDragStop(e)});this.initialized=true};this.isVisible=function(){return $("body").hasClass("xsidebar-visible")};this.show=function(){$("body").addClass("xsidebar-visible")};this.hide=function(){$("body").removeClass("xsidebar-visible");this.mainscreencontent.css("width","").css("right","0px")};this.validateSize=function(size){if(size==undefined){return 250}if(size>this.mainscreen.width()/2){return this.mainscreen.width()/2}if(size<150){return 150}return size};this.setSize=function(size){size=size==undefined?xsidebar.sidebar.width():size;this.sidebar.width(size);this.splitter.css("right",size+"px");this.mainscreencontent.css("right",(size+12)+"px")};this.saveVisibility=function(){if(window.UI){window.UI.save_pref("xsidebar-visible",$("body").hasClass("xsidebar-visible")?1:0)}};this.toggle=function(){if(this.isVisible()){this.hide()}else{this.show();this.setSize()}this.saveVisibility()};this.onSplitterDragStart=function(event){$("#mailpreviewframe").append($("<div>").attr("id","xsidebar-preview-frame-overlay"));if(bw.konq||bw.chrome||bw.safari){document.body.style.webkitUserSelect="none"}this.draggingSplitter=true};this.onSplitterDrag=function(event){if(!this.draggingSplitter){return}this.setSize(this.mainscreen.width()-event.pageX)};this.onSplitterDragStop=function(event){if(!this.draggingSplitter){return}$("#xsidebar-preview-frame-overlay").remove();if(bw.konq||bw.chrome||bw.safari){document.body.style.webkitUserSelect="auto"}this.draggingSplitter=false;this.setSize(this.validateSize(this.mainscreen.width()-event.pageX));if(window.UI){window.UI.save_pref("xsidebar-size",this.sidebar.width())}};this.toggleBox=function(id,element){var parent=$(element).parents(".box-wrap");if(parent.hasClass("collapsed")){parent.find(".box-content").slideDown(200,function(){parent.removeClass("collapsed");xsidebar.saveToggleBox()})}else{parent.find(".box-content").slideUp(200,function(){parent.addClass("collapsed");xsidebar.saveToggleBox()})}};this.saveToggleBox=function(){var collapsed=[];$("#xsidebar .box-wrap").each(function(){if($(this).hasClass("collapsed")){collapsed.push($(this).attr("data-name"))}});rcmail.save_pref({name:"xsidebar_collapsed",value:collapsed})}};