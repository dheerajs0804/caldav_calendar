<div class="app">
<<<<<<< HEAD
  <div class="header">
    <h1>Mithi Calendar</h1>
    <div class="header-controls">
      <button (click)="openAddEventModal()" class="add-event-btn">+ Add Event</button>
      <button (click)="syncCalDAV()" class="sync-btn">Sync CalDAV</button>
      <button (click)="refreshEvents()" class="sync-btn" style="margin-left: 8px;">üîÑ Refresh Events</button>
=======
  <!-- Always show calendar app -->
  <div class="calendar-app">
    <div class="header">
      <h1>Mithi Calendar</h1>
      <div class="user-info">
        <span *ngIf="currentUser">Welcome, {{ currentUser.username }}</span>
        <button (click)="logout()" class="logout-btn">Logout</button>
      </div>
      <div class="header-controls">
        <button (click)="openAddEventModal()" class="add-event-btn">+ Add Event</button>
        <button (click)="syncCalDAV()" class="sync-btn">Sync CalDAV</button>
        <button (click)="refreshEvents()" class="sync-btn" style="margin-left: 8px;">üîÑ Refresh Events</button>
        <button (click)="forceRefreshEvents()" class="sync-btn" style="margin-left: 8px;">üßπ Force Refresh</button>
        <button (click)="forceSyncFromServer()" class="sync-btn" style="margin-left: 8px;">üîÑ Force Sync</button>
        <button (click)="checkReminders()" class="test-reminder-btn" style="margin-left: 8px;">üîç Debug Reminders</button>
        <button (click)="clearNotifiedEvents()" class="test-reminder-btn" style="margin-left: 8px;">üßπ Clear Notified</button>
      </div>
>>>>>>> 7a0647a0a1dd634bb8dc15c71db3aef7d799893d
    </div>
  
  <div class="calendar-container">
    <div class="toolbar">
      <div class="view-controls">
        <button
          *ngFor="let view of views"
          (click)="changeView(view.type)"
          [class]="'view-btn ' + (currentView.type === view.type ? 'active' : '')"
        >
          {{ view.icon }} {{ view.label }}
        </button>
      </div>
      
      <div class="navigation">
        <button (click)="goToPrevious()" class="nav-btn">‚Äπ</button>
        <button (click)="goToToday()" class="today-btn">Today</button>
        <button (click)="goToNext()" class="nav-btn">‚Ä∫</button>
      </div>
      
      <div class="current-date">
        <span *ngIf="currentView.type === 'day'">
          {{ currentDate | date:'EEEE, MMMM d, y' }}
        </span>
                 <span *ngIf="currentView.type === 'week'">
           {{ getWeekDateRange() }}
         </span>
        <span *ngIf="currentView.type === 'month'">
          {{ currentDate | date:'MMMM y' }}
        </span>
        <span *ngIf="currentView.type === 'agenda'">Agenda View</span>
      </div>
    </div>
    
    <div class="calendar-content">
      <!-- Day View -->
      <app-day-view 
        *ngIf="currentView.type === 'day'"
        [date]="currentDate"
        [events]="events"
        [calendars]="calendars"
        (deleteEvent)="confirmDeleteEvent($event)"
        (eventClick)="openEventDetail($event)"
      ></app-day-view>
      
      <!-- Week View -->
      <app-week-view 
        *ngIf="currentView.type === 'week'"
        [date]="currentDate"
        [events]="events"
        [calendars]="calendars"
        (deleteEvent)="confirmDeleteEvent($event)"
        (eventClick)="openEventDetail($event)"
      ></app-week-view>
      
      <!-- Month View -->
      <app-month-view 
        *ngIf="currentView.type === 'month'"
        [date]="currentDate"
        [events]="events"
        [calendars]="calendars"
      ></app-month-view>
      
      <!-- Agenda View -->
      <div *ngIf="currentView.type === 'agenda'" class="agenda-view">
        <h3>Agenda View</h3>
        <div *ngIf="events.length > 0; else noEvents" class="events-list">
          <div *ngFor="let event of events | sortByStartTime" class="event-item">
            <div class="event-header">
              <div class="event-info">
                <div class="event-date">
                  {{ event.start_time | date:'MMM d, E' }}
                </div>
                <div class="event-time">
                  {{ event.start_time | date:'h:mm a' }}
                </div>
                <div class="event-title">{{ event.title }}</div>
                <div *ngIf="event.description" class="event-description">{{ event.description }}</div>
              </div>
            </div>
          </div>
        </div>
        <ng-template #noEvents>
          <p>No events found in agenda</p>
        </ng-template>
      </div>
    </div>
  </div>

  <!-- Add Event Modal -->
  <div *ngIf="showAddEventModal" class="modal-overlay" (click)="showAddEventModal = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add Event</h2>
        <button 
          class="modal-close" 
          (click)="showAddEventModal = false"
        >
          √ó
        </button>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label for="event-summary">Summary</label>
          <input
            type="text"
            id="event-summary"
            [(ngModel)]="newEvent.summary"
            class="form-input"
            placeholder="Event title"
            autofocus
          />
        </div>
        
        <div class="form-group">
          <label for="event-location">Location</label>
          <input
            type="text"
            id="event-location"
            [(ngModel)]="newEvent.location"
            class="form-input"
            placeholder="Event location"
          />
        </div>
        
        <div class="form-group">
          <label for="event-description">Description</label>
          <textarea
            id="event-description"
            [(ngModel)]="newEvent.description"
            class="form-textarea"
            placeholder="Event description"
            rows="3"
          ></textarea>
        </div>
        
        <div class="form-group">
          <label for="event-start-date">Start Date</label>
          <div class="datetime-group">
            <input
              type="date"
              id="event-start-date"
              [(ngModel)]="newEvent.start_date"
              class="form-input"
            />
            <label for="event-start-time">Start Time</label>
            <input
              type="time"
              id="event-start-time"
              [(ngModel)]="newEvent.start_time"
              class="form-input"
              [disabled]="newEvent.all_day"
            />
            <label class="checkbox-label">
              <input
                type="checkbox"
                id="event-all-day"
                [(ngModel)]="newEvent.all_day"
              />
              all-day
            </label>
          </div>
        </div>
        
        <div class="form-group">
          <label for="event-end-date">End Date</label>
          <div class="datetime-group">
            <input
              type="date"
              id="event-end-date"
              [(ngModel)]="newEvent.end_date"
              class="form-input"
            />
            <label for="event-end-time">End Time</label>
            <input
              type="time"
              id="event-end-time"
              [(ngModel)]="newEvent.end_time"
              class="form-input"
              [disabled]="newEvent.all_day"
            />
          </div>
        </div>
        
        <div class="form-group">
          <label for="event-attendees">Attendees</label>
          <div class="attendees-group">
            <div *ngFor="let attendee of newEvent.attendees; let i = index" class="attendee-row">
              <input
                type="email"
                [id]="'attendee-email-' + i"
                [(ngModel)]="attendee.email"
                class="form-input"
                placeholder="Email address"
                style="flex: 2;"
              />
              <input
                type="text"
                [id]="'attendee-name-' + i"
                [(ngModel)]="attendee.name"
                class="form-input"
                placeholder="Name (optional)"
                style="flex: 1;"
              />
              <select
                [id]="'attendee-role-' + i"
                [(ngModel)]="attendee.role"
                class="form-input"
                style="flex: 1;"
              >
                <option value="required">Required</option>
                <option value="optional">Optional</option>
              </select>
              <button
                type="button"
                class="btn btn-danger"
                style="padding: 4px 8px; font-size: 12px;"
                (click)="removeAttendee(i)"
                title="Remove attendee"
              >
                √ó
              </button>
            </div>
            <button
              type="button"
              class="btn btn-secondary"
              style="width: 100%; margin-top: 8px;"
              (click)="addAttendee()"
            >
              + Add Attendee
            </button>
          </div>
        </div>
        
        <div class="form-group">
          <label for="event-reminder">Reminder</label>
          <div class="reminder-group">
            <label class="checkbox-label">
              <input
                type="checkbox"
                id="event-reminder-enabled"
                [(ngModel)]="newEvent.reminder.enabled"
              />
              Enable reminder
            </label>
            
            <div *ngIf="newEvent.reminder.enabled" class="reminder-fields">
              <label for="event-reminder-type">Type</label>
              <select
                id="event-reminder-type"
                [(ngModel)]="newEvent.reminder.type"
                class="form-input"
              >
                <option value="message">Message</option>
                <option value="email">Email</option>
                <option value="notification">Notification</option>
              </select>
              
              <label for="event-reminder-time">Time</label>
              <input
                type="number"
                id="event-reminder-time"
                min="1"
                max="60"
                [(ngModel)]="newEvent.reminder.time"
                class="form-input"
                style="width: 80px;"
              />
              
              <label for="event-reminder-unit">Unit</label>
              <select
                id="event-reminder-unit"
                [(ngModel)]="newEvent.reminder.unit"
                class="form-input"
              >
                <option value="minutes">minutes before</option>
                <option value="hours">hours before</option>
                <option value="days">days before</option>
                <option value="minutes_after">minutes after</option>
                <option value="hours_after">hours after</option>
                <option value="days_after">days after</option>
                <option value="on_time">on time</option>
                <option value="on_date">on date</option>
              </select>
              
              <label for="event-reminder-relative">Relative to</label>
              <select
                id="event-reminder-relative"
                [(ngModel)]="newEvent.reminder.relativeTo"
                class="form-input"
              >
                <option value="start">start</option>
                <option value="end">end</option>
              </select>
              
              <button
                type="button"
                class="btn btn-secondary"
                style="padding: 4px 8px; font-size: 12px;"
                (click)="newEvent.reminder.enabled = false"
              >
                Remove
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <div style="display: flex; gap: 8px; margin-right: auto;">
          <button 
            *ngIf="newEvent.attendees && newEvent.attendees.length > 0"
            class="btn btn-info" 
            (click)="downloadCalendarFile()"
          >
            üìÖ Download Calendar File
          </button>
        </div>
        <button 
          class="btn btn-secondary" 
          (click)="showAddEventModal = false"
        >
          Cancel
        </button>
        <button 
          class="btn btn-primary" 
          (click)="handleAddEvent()"
          [disabled]="!newEvent.summary.trim()"
        >
          Save
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Event Detail Modal -->
<app-event-detail-modal
  [event]="selectedEvent"
  [calendars]="calendars"
  [isVisible]="showEventDetailModal"
  (closeModal)="closeEventDetail()"
  (editEvent)="editEvent($event)"
  (deleteEvent)="deleteEventFromModal($event)"
></app-event-detail-modal>
<<<<<<< HEAD

<!-- Reminder Notification Component -->
<app-reminder-notification
  [reminders]="activeReminders"
  (reminderDismissed)="onReminderDismissed($event)"
  (reminderSnoozed)="onReminderSnoozed($event)"
  (reminderDetails)="onReminderDetails($event)"
  (windowClosed)="onReminderWindowClosed()"
></app-reminder-notification>
=======
</div>
>>>>>>> 7a0647a0a1dd634bb8dc15c71db3aef7d799893d
